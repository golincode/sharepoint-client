# SharePoint REST API Client

The **SharePoint REST API Client** allows you to work with a subset of SharePoint's functionality (Lists and Users for now) using PHP.

The library is available to anyone and is licensed under the MIT license.


### Known to work with the following versions:
* SharePoint Online (2013)


## Installation

### Requirements
* PHP 5.4+
* [Guzzle](https://packagist.org/packages/guzzlehttp/guzzle)
* [PHP-JWT](https://packagist.org/packages/nixilla/php-jwt)
* [Carbon](https://packagist.org/packages/nesbot/carbon)


#### Using Composer

Add [altek/sharepoint-client](https://packagist.org/packages/altek/sharepoint-client) to your `composer.json` and run **composer install** or **composer update**.

    {
        "require": {
            "altek/sharepoint-client": "*"
        }
    }


## Usage

### Class instantiation:

    use Altek\SharePoint\SharePointException;
    use Altek\SharePoint\RESTClient;

    try {
        $config = array(
            'url'  => 'https://example-69z86c039b91sn.sharepoint.com', // Application URL
            'path' => '/sites/mySite'                                  // Application URL Path
        );

        $rc = new RESTClient($config);

    } catch(SharePointException $e) {
        // handle exceptions
    }


In order to use the **SharePoint REST API Client** methods, you need an **Access Token** which can be generated either by a logged User or an Application.

### Get an Access Token as a **User**:

    try {
        $config = array(
            'token'  => 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyNTQyNGR...', // Context Token
            'secret' => 'YzcZQ7N4lTeK5COin/nmNRG5kkL35gAW1scrum5mXVgE='
        );

        $rc->tokenFromUser($config);

    } catch(SharePointException $e) {
        // handle exceptions
    }


### Get an Access Token as an **Application**:

    try {
        $config = array(
            'acs'       => 'https://accounts.accesscontrol.windows.net/tokens/OAuth/2', // Access Control Service URL
            'client_id' => '52848cad-bc13-4d69-a371-30deff17bb4d/example.com@09g7c3b0-f0d4-416d-39a7-09671ab91f64',
            'secret'    => 'YzcZQ7N4lTeK5COin/nmNRG5kkL35gAW1scrum5mXVgE=',
            'resource'  => '00000000-0000-ffff-0000-000000000000/example-69z86c039b91sn.sharepoint.com@09g7c3b0-f0d4-416d-39a7-09671ab91f64'
        );

        $rc->tokenFromApp($config);

    } catch(SharePointException $e) {
        // handle exceptions
    }

Both methods return an Array with the access token and start/expire dates as [Carbon](https://packagist.org/packages/nesbot/carbon) objects.
The access token will be stored internally so that all methods that require it, have access to it.

**Attention:** The getCurrentUserProfile() method will throw an exception if the access token was generated by an Application


### Get the Context Web Information

    try {
        $ctx = $rc->getContextInfo();

    } catch(SharePointException $e) {
        // handle exceptions
    }

This method returns an Array with the SharePoint's library version and the Form Digest (needed to update, upload and delete Items).


### Get available Lists

    try {
        // Extra properties to add
        $extra = array(
            'is_hidden' => 'Hidden',
            // ...
        );

        $lists = $rc->getLists($extra);

    } catch(SharePointException $e) {
        // handle exceptions
    }

This method returns an Array with all the available Lists.

**Note:** By default, a List Array will only contain: GUID, Title, Description, Items, Created date as a [Carbon](https://packagist.org/packages/nesbot/carbon) object.

If more information about a List is needed, use the **$extra** Array parameter to add other properties returned by the SharePoint API to the resulting Array.


### Get the Item count of a List

    try {
        $library = 'MyLibrary';

        $count = $rc->getListItemCount($library);

    } catch(SharePointException $e) {
        // handle exceptions
    }

This method returns an integer with the number of Items that exist in a List.


### Get the Items from a specific List

    try {
        $library = 'MyLibrary';

        // Extra properties to add
        $extra = array(
            'content_type_id' => 'ContentTypeId',
            // ...
        );

        $items = $rc->getListItems($library, $extra);

    } catch(SharePointException $e) {
        // handle exceptions
    }

This method returns an Array with all the available Items from a List.

**Note:** By default, an Item Array will only contain: ID, GUID, Title, Entity Type, URI, Author ID, Editor ID, and Created/Modified date as [Carbon](https://packagist.org/packages/nesbot/carbon) objects.

If more information about an Item is needed, use the **$extra** Array parameter to add other properties returned by the SharePoint API to the resulting Array.


### Get an Item from a specific List

    try {
        $library = 'MyLibrary';

        $id = 1;

        // Extra properties to add
        $extra = array(
            'content_type_id' => 'ContentTypeId',
            // ...
        );

        $item = $rc->getListItem($library, $id, $extra);

    } catch(SharePointException $e) {
        // handle exceptions
    }

This method returns an Array with the Item information.

**Note:** By default, an Item Array will only contain: ID, GUID, Title, Entity Type, URI, Author ID, Editor ID, and Created/Modified date as [Carbon](https://packagist.org/packages/nesbot/carbon) objects.

If more information about an Item is needed, use the **$extra** Array parameter to add other properties returned by the SharePoint API to the resulting Array.


### Upload an Item to a List

    try {
        $library = 'MyLibrary';

        $file = '/path/to/a/file.jpg';

        // Item properties
        $properties = array(
            'Title' => 'A picture in JPEG format',
            // ...
        );

        // Silently overwrite an existing file with the same name
        $overwrite = true;

        $rc->uploadListItem($library, $file, $properties, $overwrite);

    } catch(SharePointException $e) {
        // handle exceptions
    }

This method returns true if the file was successfully uploaded.

**Note:** If the **$overwrite** value is false, an exception will be thrown when a file with the same name already exists.
